var bcrypt,mongoose,userModel,userSchema;mongoose=require("mongoose"),bcrypt=require("bcrypt-nodejs"),userSchema=mongoose.Schema({facebook:{id:String,token:String,email:String,full_name:String,first_name:String,last_name:String,photos:Array,date:{type:Date,"default":Date.now}},matches:{type:Array,"default":[]},penalties:{type:Array,"default":[]},status:{type:String,required:!0},phone:{type:String,validate:{validator:function(e){return/\d{3}-?\d{3}?-?\d{4}/.test(e)},message:"{VALUE} is not a valid phone number!"},"default":"000-000-0000"}}),userSchema.methods.generateHash=function(e){return bcrypt.hashSync(e,bcrypt.genSaltSync(8),null)},userSchema.methods.validPassword=function(e){return bcrypt.compareSync(e,this.local.password)},userModel=mongoose.model("User",userSchema),userSchema.pre("save",function(e){var r;return r=this,userModel.find({name:r.name},function(t,n){return n.length?(console.log("user exists: ",r.name),e(new Error("User exists!"))):e()})}),module.exports=mongoose.model("User",userSchema);